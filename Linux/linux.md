# Unix和Linux区别

- Linux开源，Unix付费
- linux可运行在多种硬件平台上，跨平台性能更好，Unix较弱，大多需与硬件配套使用
- linux有图形化界面，unix只是命令行下的系统
- linux对硬件要求较低，安装方法简单；unix对硬件要求苛刻，安装难度大
- linux用户广泛；unix较多为安全性要求高的企业使用

# 什么是Linux内核和基本组件

- linux内核是控制系统中所有的软硬件
- 系统内存管理
- 应用程序管理
- 硬件设备管理
- 文件系统管理
- 内核、shell和GUI

# 体系结构

- 用户空间：包括 用户的应用程序、C库
- 内核空间：包括系统调用接口、内核、平台架构相关的代码

# 分为用户空间和内核空间的原因

- 现代CPU实现了不同的工作模式，不同模式下CPU可用执行的指令和访问的寄存器不同
- Linux从CPU角度处罚，为保护内核安全，将系统分为两部分
- 用户空间和内核空间是程序执行的两种不同状态，可以通过两种方式完成用户空间到内核空间的转移：系统调用 和 硬件中断

# Linux开机启动过程

- 主机加电自检，加载BIOS硬件信息
- 读取MBR 的引导文件（GRUB，LILO）
- 引导Linux内核
- 运行第一个进程 init （进程号永远为1）
- 进入相应的运行级别
- 运行终端，输入用户名和密码

# Linux系统缺省的运行级别

- 关机
- 单机用户模式
- 字符界面的多用户模式（不支持网络）
- 字符界面的多用户模式
- 未分配使用
- 图形界面的多用户模式
- 重启

# 进程间通信方式

- 管道（pipe）、流管道（s_pipe）、有名管道（FIFO）
- 信号（signal）
- 消息队列
- 共享内存
- 信号量
- 套接字（socket）

# 有哪些系统日志

- 比较重要的是 /var/log/messages 日志文件

  该日志是许多进程日志文件的汇总

# 交换空间

- 交换空间是Linux使用的一定空间，用于临时保存一些并发运行的程序。当RAM没有足够的内存来容纳正在执行的所有程序时，就会发生这种情况

# LILO

是Linux的引导加载程序。主要用于将Linux操作系统加载到主内存中，以便它可以开始运行

# CLI

- 命令行界面（command-line interface）

# GUI

- 图形用户界面（Graphical User Interface）

# 文件系统

在Linux操作系统中，所有被操作系统管理的资源，例如网络接口、磁盘驱动器、打印机、目录等都被看作是一个文件。

- Linux支持的5种文件类型

  | 文件类型 | 描述                                                         | 示例                                   |
  | -------- | ------------------------------------------------------------ | -------------------------------------- |
  | 普通文件 | 用来在辅助存储设备（如磁盘）上存储信息和数据                 | 包含程序源码、可执行程序、图片、声音等 |
  | 目录文件 | 用于表示和管理系统中的文件，目录文件中包含一些文件名和子目录名 | /root、/home                           |
  | 链接文件 | 用于不同目录下文件的共享                                     | 软链接、硬链接                         |
  | 设备文件 | 用来访问硬件设备                                             | 包括键盘、硬盘、光驱、打印机等         |
  | 命名管道 | 一种特殊类型的文件，进程之间的通信可通过该文件完成           |                                        |

# 目录结构

![image-20221126172314562](/home/hzg/doc/learn/Linux/image-20221126172314562.png)

常见目录说明：

| 目录        | 说明                                                         |
| ----------- | ------------------------------------------------------------ |
| /bin        | 存放二进制可执行文件（ls、cat等），常用命令一般都在这里      |
| /etc        | 存放系统管理和配置文件                                       |
| /home       | 存放所有用户文件的根目录                                     |
| /usr        | 存放系统应用程序                                             |
| /opt        | 额外安装的可选应用程序包所放置的位置                         |
| /proc       | 虚拟文件系统目录，是系统内存的映射。可直接访问这个目录来获取系统信息 |
| /root       | 超级用户（系统管理员）的主目录（特权阶级）；                 |
| /sbin       | 存放二进制可执行文件，只有root才能访问。这里存放的是系统管理员使用的系统级别的管理命令和程序。如ifconfig等； |
| /dev        | 用于存放设备文件                                             |
| /mnt        | 系统管理员安装临时文件系统的安装点，系统提供这个目录是让用户临时挂载其他的文件系统； |
| /boot       | 存放用于系统引导时使用的各种文件；                           |
| /lib        | 存放着和系统运行相关的库文件 ；                              |
| /tmp        | 用于存放各种临时文件，是公用的临时文件存储点；               |
| /var        | 用于存放运行时需要改变数据的文件，也是某些大文件的溢出区，比方说各种服务的日志文件（系统启动日志等。）等； |
| /lost+found | 这个目录平时是空的，系统非正常关机而留下“无家可归”的文件（windows下叫什么.chk）就在这里 |

# inode

inode是linux文件系统和硬盘存储的基础。

- 文件存储在硬盘中，硬盘的最小存储单位叫做 “扇区”（sector）。每个扇区存储 512 字节（相当于0.5KB）
- 操作系统读取硬盘的时候，不会一个个扇区地读取，这样效率太低，而是一次性连续读取多个扇区，即一次性读取一个 “块” 。这种由多个扇区组成的 “块”，是文件存取的最小单位。“块” 的大小，最常见的是 4KB，即连续 8个 sector组成一个block
- 文件数据都是存储在 “块” 中，那么很显然，需要找到一个地方存储文件的元信息，比如文件的创建者、创建日期、大小等。存储文件元信息的区域就是 inode，中文叫 “索引节点”。
- 每个文件都有对应的 inode，里面包含了与该文件有关的一些信息。

# Linux文件系统通过 i 节点把文件的逻辑结构和物理结构转换的工作过程

- linux通过inode节点表将文件的逻辑结构和物理结构进行转换
- inode 节点是一个 64 字节长的表，表中包含了文件的相关信息，其中有文件的大小、文件所有者、文件的存取许可方式以及文件的类型等重要信息。在 inode 节点表中最重要的内容是磁盘地址表。在磁盘地址表中有 13 个块号，文件将以块号在磁盘地址表中出现的顺序依次读取相应的块。
- Linux 文件系统通过把 inode 节点和文件名进行连接，当需要读取该文件时，文件系统在当前目录表中查找该文件名对应的项，由此得到该文件相对应的 inode 节点号，通过该 inode 节点的磁盘地址表把分散存放的文件物理块连接成文件的逻辑结构。

# 硬链接和软链接

- 硬链接：系统不重新分配 inode。
  - 不可在不同文件系统的文件间建立链接
- 软链接：创建一个新的 inode 节点
- 区别：
  - 硬链接不可以跨分区，软件链可以跨分区
  - 硬链接指向一个 inode 节点，而软链接则是创建一个新的 inode 节点
  - 删除硬链接文件，不会删除原文件，删除软链接文件，会把原文件删除

# RAID

- RAID 0

  <img src="/home/hzg/doc/learn/Linux/image-20221126181258335.png" alt="image-20221126181258335" style="zoom:50%;" />

- RAID 1

  <img src="/home/hzg/doc/learn/Linux/image-20221126181653854.png" alt="image-20221126181653854" style="zoom:50%;" />

# ./和sh区别

- 使用 ./ 执行脚本，对应的 xxx.sh 必须有执行权限；而 sh 可以没有

# 实战

## 有哪些因素会导致网站访问慢

- 服务器出口带宽受限
- 服务器负载大，导致响应慢
- 数据库瓶颈
- 网站开发代码没有优化好

## 针对网站访问慢，如何排查

- 确定是用户端还是服务端问题
- 如果访问慢，可利用浏览器调试功能，看加载哪一项数据消耗的时间过多，是图片加载慢，还是某些数据加载慢
- 针对服务器负载情况，查看服务器硬件，比如CPU、内存、带宽使用情况
- 发现硬件资源消耗不高，查看日志，比如MySQL慢查询的日志等

## 怎么解决

- 如果是出口带宽，申请扩大带宽
- 如果慢查询太多，要求开发人员或DBA协助进行SQL优化
- 如果数据库响应慢，考虑加一个数据库缓存，如Redis等，MySQL主从
- 申请CDN
- 如果访问还比较慢，从整体架构上进行优化，例如负载均衡等

## Linux性能调优方法

1、Disabling daemons (关闭 daemons)。

2、Shutting down the GUI (关闭 GUI)。

3、Changing kernel parameters (改变内核参数)。

4、Kernel parameters (内核参数)。

5、Tuning the processor subsystem (处理器子系统调优)。

6、Tuning the memory subsystem (内存子系统调优)。

7、Tuning the file system (文件系统子系统调优)。

8、Tuning the network subsystem（网络子系统调优)。